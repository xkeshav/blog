---
import ThemeToggle from "../ThemeToggle.astro";
import Search from "../Search.astro";
import { menuLinks } from "@/site-config";

const url = new URL(Astro.request.url);
---

<header id="main-header" class="group relative mb-28 flex items-center sm:ps-[4.5rem]">
  <div class="flex sm:flex-col">
    <a
      href="/"
      class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block"
      aria-current={url.pathname === "/" ? "page" : false}
    >
      <svg
        class="sm:h-18 h-18 my-2 me-3 w-6 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:w-12"
        aria-hidden="true"
        focusable="false"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        shape-rendering="geometricPrecision"
        text-rendering="geometricPrecision"
        image-rendering="optimizeQuality"
        fill-rule="evenodd"
        clip-rule="evenodd"
        viewBox="0 0 512 467.36"
      >
        <title>Logo</title>
        <path
          fill-rule="nonzero"
          d="M58.327 0h281.809c-12.343 13.848-23.287 27.375-32.932 40.444H58.327c-4.929 0-9.415 2.01-12.656 5.227a17.95 17.95 0 00-5.227 12.657v350.705c0 4.868 2.04 9.331 5.288 12.579 3.264 3.263 7.75 5.304 12.595 5.304h395.345c4.815 0 9.286-2.056 12.557-5.327 3.271-3.271 5.326-7.742 5.326-12.556V173.301A950.502 950.502 0 00512 155.387v253.646c0 15.995-6.611 30.592-17.173 41.154-10.562 10.562-25.159 17.173-41.155 17.173H58.327c-15.996 0-30.623-6.58-41.193-17.15C6.595 439.671 0 425.082 0 409.033V58.328c0-16.012 6.565-30.57 17.111-41.132l.084-.084C27.757 6.565 42.316 0 58.327 0zm178.36 158.589c6.833 7.054 14.49 15.285 22.63 24.334a902.98 902.98 0 0118.494-17.845c57.166-53.59 121.141-99.314 177.703-120.561 5.732-2.155 12.136.734 14.291 6.466a11.11 11.11 0 01-2.889 12.098c-23.515 25.09-50.562 51.51-78.786 79.077-29.148 28.475-59.565 58.197-87.904 88.117a1866.704 1866.704 0 0119.779 24.127c26.099 32.405 49.929 64.32 62.668 85.497 3.142 5.25 1.43 12.067-3.821 15.208a11.024 11.024 0 01-7.482 1.422l-34.888-4.425a11.06 11.06 0 01-7.451-4.318c-19.358-25.664-41.613-51.793-65.305-77.304-25.518 29.569-47.513 58.87-62.729 86.895-2.064 3.798-6.038 5.9-10.088 5.778l-47.62-.933c-6.115-.091-10.991-5.135-10.899-11.249a11.253 11.253 0 011.185-4.853c18.953-37.25 49.386-79.673 85.901-120.988-33.864-33.1-68.759-63.815-101.133-89.447-4.791-3.783-5.609-10.761-1.826-15.553a10.96 10.96 0 016.572-3.997c25.939-5.128 46.451-2.69 64.755 5.327 17.86 7.833 32.992 20.78 48.843 37.127z"
          fill="#B04304"></path></svg
      >
      <span class="text-xl font-bold sm:text-2xl">Keshav Mohta</span>
    </a>
    <nav
      id="navigation-menu"
      class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
      aria-label="Main menu"
    >
      {
        menuLinks.map((link) => (
          <a
            href={link.path}
            class="px-4 py-4 sm:py-0 sm:hover:underline"
            aria-current={url.pathname === link.path ? "page" : false}
            data-astro-prefetch
          >
            {link.title}
          </a>
        ))
      }
    </nav>
  </div>
  <Search />
  <ThemeToggle />
  <mobile-button>
    <button
      id="toggle-navigation-menu"
      class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden"
      type="button"
      aria-label="Open main menu"
      aria-expanded="false"
      aria-haspopup="menu"
    >
      <svg
        id="line-svg"
        class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
        aria-hidden="true"
        focusable="false"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5"></path>
      </svg>
      <svg
        id="cross-svg"
        class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
        class="text-accent"
        aria-hidden="true"
        focusable="false"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </mobile-button>
</header>

<script>
  import { toggleClass } from "@/utils";

  class MobileNavBtn extends HTMLElement {
    private headerEl: HTMLElement;
    private mobileButtonEl: HTMLButtonElement;
    private menuOpen: boolean;

    constructor() {
      super();
      this.headerEl = document.getElementById("main-header")!;
      this.mobileButtonEl = this.querySelector("button") as HTMLButtonElement;
      this.menuOpen = false;

      this.mobileButtonEl.addEventListener("click", this.toggleMobileMenu);
    }

    toggleMobileMenu = () => {
      toggleClass(this.headerEl, "menu-open");
      this.menuOpen = !this.menuOpen;
      this.mobileButtonEl.setAttribute("aria-expanded", this.menuOpen.toString());
    };
  }

  customElements.define("mobile-button", MobileNavBtn);
</script>
